var gs_Iron_Sword_Path = [
    [{type: 'node', name:'Iron Sword', rarity: 1, attack: 288, ele_type: "No Element", ele_val: "", num_slot : "---", affinity: "0%", flavour:"A weapon that even novice hunters can use. Charge up for a more powerful slash.", upgrade:[], craft:["750z", "Iron Ore", 3], shop: "1500z", sharp:"Img/Weap/gs/Iron_Sword/base_sharp.png", p_sharp:"Img/Weap/gs/Iron_Sword/plus_sharp.png", pic:'Img/Weap/gs/Iron_Sword/render.png', parent:[], playstyle: "Blademaster", extra: ""}],
    [{type: 'connector', pic: "Img/connector_5.png"}],
    [{type: 'node', name: 'Iron Sword+', rarity: 1, attack: 336, ele_type: "No Element", ele_val: "", num_slot: "---", affinity: "0%", flavour: "A weapon that even novice hunters can use. Charge up for a more powerful slash.", upgrade: ["650z", "Iron Ore", 5], craft: [], shop: "N/A", sharp: "Img/Weap/gs/Iron_Sword+/base_sharp.png", p_sharp: "Img/Weap/gs/Iron_Sword+/plus_sharp.png", pic: "Img/Weap/gs/Iron_Sword+/render.png", parent: ["Iron Sword", 0, 0], playstyle: "Blademaster", extra: ""}],
    [{type: "connector", pic: "Img/connector_2.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_4.png"}],
    [{type: 'node', name: 'Buster Sword', rarity: 1, attack: 384, ele_type: "No Element", ele_val: "", num_slot: "---", affinity: "0%", flavour: "A strong blade made from high-purity iron. A popular choice among hunters.", upgrade: ["850z", "Machalite Ore", 2, "Iron Ore", 8], craft: [], shop: "N/A", sharp:"Img/Weap/gs/Buster_Sword/base_sharp.png", p_sharp: "Img/Weap/gs/Buster_Sword/plus_sharp.png", pic: "Img/Weap/gs/Buster_Sword/render.png", parent: ["Iron Sword+", 0, 2], playstyle: "Blademaster", extra: ""}, {type: "blank"}, {type: "blank"}, {type: "blank"}, {type: "blank"}, 
    {type: "node", name: "Rugged Great Sword", rarity: 1, attack: 480, ele_type: "No Element", ele_val: "", num_slot: "---", affinity: "0%", flavour: "A blade made of the Jaggi's colorful hide. Standard gear for hunters in some regions.", upgrade: ["1400z", "G. Jaggi Claw", 4, "Jaggi Hide", 8, "Machalite Ore", 3], craft: ["2100z", "G. Jaggi Claw", 6, "G. Jaggi Hide", 3, "Machalite Ore", 6], shop: "N/A", sharp: "Img/Weap/gs/Rugged_Great_Sword/base_sharp.png", p_sharp: "Img/Weap/gs/Rugged_Great_Sword/plus_sharp.png", pic: "Img/Weap/gs/Rugged_Great_Sword/render.png", parent: ["Iron Sword+", 0, 2], playstyle: "Blademaster", extra: ""}],
    [{type: "connector", pic: "Img/connector_2.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_4.png"}, {type: "blank"}, {type: "connector", pic: "Img/connector_2.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_3.png"}, {type: "connector", pic: "Img/connector_4.png"}],
    [{type: 'node', name: 'Buster Sword+', rarity: 2, attack: 480, ele_type: 'No Element', ele_val: '', num_slot: '---', affinity: '0%', flavour: 'A strong blade made from high-purity iron. A popular choice among hunters.', upgrade: ["1400z", "Machalite Ore", 5, "Earth Crystal", 2, "Iron Ore", 5], craft: [], shop: 'N/A', sharp: 'Img/Weap/gs/Buster_Sword+/base_sharp.png', p_sharp: 'Img/Weap/gs/Buster_Sword+/plus_sharp.png', pic: 'Img/Weap/gs/Buster_Sword+/render.png', parent: ["Buster Sword", 0, 4], playstyle: 'Blademaster', extra: ''}, {type: 'blank'}, {type: 'blank'},
    {type: 'node', name: 'Santoku Reaver', rarity: 2, attack: 624, ele_type: 'No Element', ele_val: '', num_slot: '---', affinity: '-10%', flavour: 'A blade made of sharpened Tetsucabra shell. The whorls on the blade affect value.', upgrade: ["2150z", "Tetsucabra Claw", "2", "Tetsucabra Shell", "2", "Machalite Ore", "2"], craft: ["3225z", "Tetsucabra Claw", "3", "Tetsucabra Shell", "3", "Tetsucabra Tusks", "2", "Machalite Ore", "5"], shop: 'N/A', sharp: 'Img/Weap/gs/Santoku_Reaver/base_sharp.png', p_sharp: 'Img/Weap/gs/Santoku_Reaver/plus_sharp.png', pic: 'Img/Weap/gs/Santoku_Reaver/render.png', parent: ["Buster Sword", 0, 4], playstyle: 'Blademaster', extra: ''}, {type: 'blank'},
    {type: 'node', name: "Chieftain's Great Sword", rarity: 2, attack: 528, ele_type: 'No Element', ele_val: '', num_slot: '---', affinity: '0%', flavour: "A blade made of the Jaggi's colorful hide. Standard gear for hunters in some regions.", upgrade: ["1400z", "King's Frill", "4", "G. Jaggi Hide", "5", "Kecha Pelt", "5"], craft: [], shop: 'N/A', sharp: "Img/Weap/gs/Chieftain's_Great_Sword/base_sharp.png", p_sharp: "Img/Weap/gs/Chieftain's_Great_Sword/plus_sharp.png", pic: "Img/Weap/gs/Chieftain's_Great_Sword/render.png", parent: ["Rugged Great Sword", 5, 4], playstyle: 'Blademaster', extra: ''}, {type: 'blank'}, {type: 'blank'}, {type: 'blank'},
    {type: 'node', name: "Ludroth Bone Sword", rarity: 2, attack: 480, ele_type: 'Water', ele_val: '230', num_slot: '---', affinity: '0%', flavour: "A blade reinforced with Ludroth parts. A good base level for further upgrading", upgrade: ["1750z", "Spongy Hide", "1", "Monster Fluid", "2", "Monster Bone S", "3"], craft: ["2625z", "Royal Ludroth Claw", "2", "Spongy Hide", "2", "Monster Fluid", "2", "Monster Bone M", "2"], shop: 'N/A', sharp: "Img/Weap/gs/Ludroth_Bone_Sword/base_sharp.png", p_sharp: "Img/Weap/gs/Ludroth_Bone_Sword/plus_sharp.png", pic: "Img/Weap/gs/Ludroth_Bone_Sword/render.png", parent: ["Rugged Great Sword", 5, 4], playstyle: 'Blademaster', extra: ''}]
]

//{type: 'node', name: "", rarity: , attack: , ele_type: '', ele_val: '', num_slot: '', affinity: '', flavour: "", upgrade: [], craft: [], shop: '', sharp: "", p_sharp: "", pic: "", parent: [], playstyle: '', extra: ''}
//{type: 'connector', pic: 'Img/connector_.png'}
//{type: 'blank'}

var gs_trees = ["Iron_Sword_Path"];
var ls_trees = [];
var sns_trees = [];
var db_trees = [];
var ham_trees = [];
var hrn_trees = [];
var lan_trees = [];
var gl_trees = [];
var sa_trees = [];
var cb_trees = [];
var ig_trees = [];
var lbg_trees = [];
var hbg_trees = [];
var bow_trees = [];

var node_num = 0;
var selected_node = -1;
var curr_selected_tree = [];
var info_box_present = false;


var selected_gear = '';

var weap_toggle = 0;
var arm_toggle = 0;

function disp_Node(x, y, parent_id, tree_arr){
    var nDiv = document.createElement('div');
    var nImg = document.createElement('img');
    var new_id = node_num;
    
    var nTitle = document.createElement('div');
    nTitle.style.height = '50%';
    nTitle.style.width = '100%';
    nTitle.style.overflow = 'auto'
    nTitle.style.position = "absolute";
    nTitle.style.top = '0px';
    nTitle.style.left = '0px';
    nTitle.style.zIndex = '2';
    
    
    nDiv.id = new_id*10;
    nTitle.id = nDiv.id+"_title";
    nDiv.className = 'panel';
    nImg.className = 'ImgPan';
    
    nImg.src = tree_arr[y][x].pic;
    
    nDiv.style.top = (y*100)+'px';
    nDiv.style.left = (x*100 + 1)+'px';
   
    nDiv.style.borderColor = "dimgray";
    
    //nDiv.innerHTML = tree_arr[y][x].name;
    nTitle.innerHTML = tree_arr[y][x].name;
    //nDiv.style.color = update_rare_color(tree_arr[y][x].rarity);
    nTitle.style.color = update_rare_color(tree_arr[y][x].rarity);
    //nDiv.style.textShadow = "1px 0px rgba(156,154,160,0.5)";
    //nTitle.style.textShadow = "0px 1px grey";
    nDiv.onclick = function(){
        if(selected_node == -1){
            selected_node = nDiv.id;
            nDiv.style.borderColor = 'turquoise';
            disp_info_box(x, y, tree_arr);
        }
        else{
            if(selected_node == nDiv.id){
                selected_node = -1;
                nDiv.style.borderColor = 'dimgray';
                remove_info_box();

            }
            else{
                document.getElementById(selected_node).style.borderColor = 'dimgray';
                selected_node = nDiv.id;
                nDiv.style.borderColor = 'turquoise';
                disp_info_box(x, y, tree_arr);

                clear_cost_panel();
            }
        }
        
    };
    
    nDiv.appendChild(nTitle);
    
    nDiv.appendChild(nImg);
    document.getElementById(parent_id).appendChild(nDiv);
    
    node_num += 1;
}

function disp_Conn(x, y, parent_id, tree_arr){
    var nDiv = document.createElement('div');
    var nImg = document.createElement('img');
    
    nDiv.className = 'conn_panel';
    nImg.className = 'ConnPan';
    
    nImg.src = tree_arr[y][x].pic;
    
    nDiv.style.top = (y*100) + 'px';
    nDiv.style.left = (x*100) + 'px';
    
    nDiv.appendChild(nImg);
    
    document.getElementById(parent_id).appendChild(nDiv);
    
}

function disp_Tree(tree_arr){
    
    
    delete_tree();
    
    var nDiv = document.createElement('div');
    nDiv.id = 'diagram';
    nDiv.style.position = 'absolute';
    
    nDiv.style.left = '0px';
    nDiv.style.border = "1px outset";
    nDiv.style.backgroundImage = "url(Img/tree_back.jpg)";
    nDiv.style.backgroundSize = "cover";
    nDiv.style.transition = "300ms";
    nDiv.className = "tree_diagram";
    
    var height = tree_arr.length * 100;
    var width = 0;
    for (var index = 0; index < tree_arr.length; index++){
        if (width < tree_arr[index].length){
            width = tree_arr[index].length;
        }
    }
    
    width *= 100;
    
    nDiv.style.height = (height + 50)+'px';
    nDiv.style.width = (width + 50)+'px';
    
    var r_limit = document.createElement('div');
    var b_limit = document.createElement('div');
    
    r_limit.id = "right_limit";
    b_limit.id = "bottom_limit";
    
    r_limit.style.right = "-600px";
    b_limit.style.bottom = "-100px";
    
    nDiv.appendChild(r_limit);
    nDiv.appendChild(b_limit);
    
    document.getElementById("content").appendChild(nDiv);
    
    for (var y = 0; y < tree_arr.length; y++){
        for(var x = 0; x < tree_arr[y].length; x++){
            if(tree_arr[y][x].type != 'blank'){
                if (tree_arr[y][x].type == 'connector'){
                    disp_Conn(x, y, nDiv.id, tree_arr);
                }
                else{
                    disp_Node(x, y, nDiv.id, tree_arr);
                }
            }
        }
    }
    
        document.getElementById("info_box").style.visibility = "visible";
        document.getElementById("info_box").style.opacity = 1;
        document.getElementById("page_1").style.visibility = "visible";
        document.getElementById("page_1").style.opacity = 1;
        info_box_present = true;
        remove_info_box();
    
    
    
}

function delete_tree(){
    
    var content_div = document.getElementById("content");
    var tree_div = document.getElementById('diagram');
    var dia_div = document.getElementById('diagram2');
    

    if(tree_div != null){

        content_div.removeChild(tree_div);    
        node_num = 0;
        selected_node = -1;
        remove_info_box();
    }

    
}

function toggle_page(page_num){
    switch(page_num){
        case 1:
            document.getElementById("page_1").style.visibility = "hidden";
            document.getElementById("page_1").style.opacity = 0;
            document.getElementById("page_2").style.visibility = "visible";
            document.getElementById("page_2").style.opacity = 1;
            document.getElementById("page_3").style.visibility = "hidden";
            document.getElementById("page_3").style.opacity = 0;
            document.getElementById("page_4").style.visibility = "hidden";
            document.getElementById("page_4").style.opacity = 0;
            document.getElementById("get_cost").style.visibility = "hidden";
            document.getElementById("get_cost").style.opacity = 0;
            break;
        
        case 2:
            document.getElementById("page_1").style.visibility = "hidden";
            document.getElementById("page_1").style.opacity = 0;
            document.getElementById("page_2").style.visibility = "hidden";
            document.getElementById("page_2").style.opacity = 0;
            document.getElementById("page_3").style.visibility = "visible";
            document.getElementById("page_3").style.opacity = 1;
            document.getElementById("page_4").style.visibility = "hidden";
            document.getElementById("page_4").style.opacity = 0;
            document.getElementById("get_cost").style.visibility = "visible";
            document.getElementById("get_cost").style.opacity = 1;
            break;
            
        case 3:
            document.getElementById("page_1").style.visibility = "hidden";
            document.getElementById("page_1").style.opacity = 0;
            document.getElementById("page_2").style.visibility = "hidden";
            document.getElementById("page_2").style.opacity = 0;
            document.getElementById("page_3").style.visibility = "hidden";
            document.getElementById("page_3").style.opacity = 0;
            document.getElementById("page_4").style.visibility = "visible";
            document.getElementById("page_4").style.opacity = 1;
            document.getElementById("get_cost").style.visibility = "visible";
            document.getElementById("get_cost").style.opacity = 1;
            break;
            
        case 4:
            document.getElementById("page_1").style.visibility = "visible";
            document.getElementById("page_1").style.opacity = 1;
            document.getElementById("page_2").style.visibility = "hidden";
            document.getElementById("page_2").style.opacity = 0;
            document.getElementById("page_3").style.visibility = "hidden";
            document.getElementById("page_3").style.opacity = 0;
            document.getElementById("page_4").style.visibility = "hidden";
            document.getElementById("page_4").style.opacity = 0;
            document.getElementById("get_cost").style.visibility = "hidden";
            document.getElementById("get_cost").style.opacity = 0;
            break;
    }
}



function disp_info_box(x, y, tree_arr){
    if (info_box_present != false){
        remove_info_box();
    }

    
    document.getElementById("info_box").style.top = (y* 100 + 20)+'px';
    document.getElementById("info_box").style.left = (x*100 +102)+'px';
    document.getElementById("info_box").style.visibility = "visible";
    document.getElementById("info_box").style.opacity = 1;
    document.getElementById("page_1").style.visibility = "visible";
    document.getElementById("page_1").style.opacity = 1;
    
    var new_y = document.getElementById("info_box").offsetTop;
    var new_x = document.getElementById("info_box").offsetleft;
    
    document.getElementById("main_cost_panel").style.top = "0px";
    document.getElementById("main_cost_panel").style.left = "0px";
    document.getElementById("shop_cost_line").innerHTML = "";
    document.getElementById("main_cost_panel").style.visibility = "hidden";
    document.getElementById("main_cost_panel").style.opacity = "0";
    
    
    info_box_present = true;
    update_info_box(tree_arr[y][x]);
}

function clear_material_info(){
    for(var i = 1; i < 5; i++){
            
        var up_clr_lable = "up_mat"+i;
        var up_clr_val = "up_mat"+i+"_amt";
        var cr_clr_lable = "cr_mat"+i;
        var cr_clr_val = "cr_mat"+i+"_amt";
            
        document.getElementById(up_clr_lable).innerHTML = "";
        document.getElementById(up_clr_val).innerHTML = "";
        document.getElementById(cr_clr_lable).innerHTML = "";
        document.getElementById(cr_clr_val).innerHTML = "";
            
    }
}

function update_info_box(node_object){
    clear_material_info();
    document.getElementById("info_name").innerHTML = node_object.name;
    document.getElementById("info_name").style.color = update_rare_color(node_object.rarity);
    document.getElementById("info_rare").innerHTML = "Rarity " + node_object.rarity;
    document.getElementById("info_rare").style.color = update_rare_color(node_object.rarity);
    document.getElementById("atk_val").innerHTML = node_object.attack;
    document.getElementById("ele_lable").innerHTML = node_object.ele_type;
    document.getElementById("ele_val").innerHTML = node_object.ele_val;
    document.getElementById("sharp_img").src = node_object.sharp;
    document.getElementById("sharp_p_img").src = node_object.p_sharp;
    document.getElementById("slot_val").innerHTML = node_object.num_slot;
    document.getElementById("aff_val").innerHTML = node_object.affinity;
    document.getElementById("weap_type_val").innerHTML = node_object.playstyle;
    document.getElementById("extra_info").innerHTML = node_object.extra;
    document.getElementById("flavour").innerHTML = node_object.flavour;
    document.getElementById("flavour").innerHTML = node_object.flavour;
    
    if (node_object.upgrade.length != 0){
        document.getElementById("parent_lable").innerHTML = "Material List";
        document.getElementById("up_cost_lable").innerHTML = "Cost"
        document.getElementById("parent_name").innerHTML = node_object.parent[0];
        document.getElementById("parent_name").style.borderTopStyle = "groove";
        document.getElementById("parent_name").style.borderBottomStyle = "groove";
        document.getElementById("up_cost").innerHTML = node_object.upgrade[0];
        var up_count = 1;
        for(var i = 1; i < node_object.upgrade.length; i+=2){
            var mat_name = node_object.upgrade[i];
            var mat_amt = node_object.upgrade[i+1];
            
            var up_lable_id = "up_mat"+up_count;
            var up_val_id = "up_mat"+up_count+"_amt";
            
            document.getElementById(up_lable_id).innerHTML = mat_name;
            document.getElementById(up_val_id).innerHTML = mat_amt;
            up_count++;
            
        }
    }
    else{
        document.getElementById("parent_name").innerHTML = "Nothing";
        document.getElementById("parent_lable").innerHTML = "";
        document.getElementById("up_cost_lable").innerHTML = '';
        document.getElementById("up_cost").innerHTML = '';
        document.getElementById("parent_name").style.borderTopStyle = "groove";
        document.getElementById("parent_name").style.borderBottomStyle = "groove";
        
    }
    
    if (node_object.craft.length != 0){
        document.getElementById("cr_cost_lable").innerHTML = "Cost";
        document.getElementById("cr_cat").innerHTML = "Crafting Materials";
        document.getElementById("cr_cost").innerHTML = node_object.craft[0];
        var cr_count = 1;
        for(var x = 1; x < node_object.craft.length; x+=2){
            var cr_mat_name = node_object.craft[x];
            var cr_mat_amt = node_object.craft[x+1];
            
            var cr_lable_id = "cr_mat"+cr_count;
            var cr_val_id = "cr_mat"+cr_count+"_amt";

            
            document.getElementById(cr_lable_id).innerHTML = cr_mat_name;
            document.getElementById(cr_val_id).innerHTML = cr_mat_amt;
            cr_count++;
        }
    }
    else{
        document.getElementById("cr_cost_lable").innerHTML = "";
        document.getElementById("cr_cost").innerHTML = "";
        document.getElementById("cr_cat").innerHTML = "Cannot be Created";

    }
    
    document.getElementById("shop_price").innerHTML = node_object.shop;
    
    document.getElementById('lg_img').src = node_object.pic;
    
}

function update_rare_color(rare){
    color='';
    switch(rare){
        case 1:
            color = "white";
            break;
            
        case 2:
            color = "rgb(140,58,165)";
            break;
            
        case 3:
            color = "yellow";
            break;
            
        case 4:
            color = "pink";
            break;
            
        case 5:
            color = "green";
            break;
            
        case 6:
            color = "cornflowerblue";
            break;
            
        case 7:
            color = "firebrick";
            break;
            
        case 8:
            color = "skyblue";
            break;
            
        case 9:
            color = "orange";
            break;
            
        case 10:
            color = "purple";
            break;
            
        
    }
    return color;
}

function remove_info_box(){
    document.getElementById("info_box").style.visibility = "hidden";
    document.getElementById("info_box").style.opacity = 0;
    document.getElementById("page_1").style.visibility = "hidden";
    document.getElementById("page_1").style.opacity = 0;
    document.getElementById("page_2").style.visibility = "hidden";
    document.getElementById("page_2").style.opacity = 0;
    document.getElementById("page_3").style.visibility = "hidden";
    document.getElementById("page_3").style.opacity = 0;
    document.getElementById("page_4").style.visibility = "hidden";
    document.getElementById("page_4").style.opacity = 0;
    document.getElementById("get_cost").style.visibility = "hidden";
    document.getElementById("get_cost").style.opacity = 0;
    info_box_present = false;
    document.getElementById("main_cost_panel").style.top = "0px";
    document.getElementById("main_cost_panel").style.left = "0px";
    document.getElementById("shop_cost_line").innerHTML = "";
    document.getElementById("main_cost_panel").style.visibility = "hidden";
    document.getElementById("main_cost_panel").style.opacity = "0";
    
    clear_cost_panel();
}

function clear_list(){
    var drop_list = document.getElementById("tree_selection");
    while (drop_list.length > 1){
        drop_list.remove(1);
    }
}

function option_select (option){
    if(option.indexOf("wpn_") != -1){
        var wpn_option = option.replace("wpn_", "");
        select_wpn_type(wpn_option);
    }
    else if(option.indexOf("armor_") != -1){
        var amr_option = option.replace("armor_", "");
        select_armor(amr_option);
        
    }
    
}

function select_wpn_type(selection){
    if(selection != selected_gear){
        document.getElementById("tree_header_bot").innerHTML = '';
        selected_gear = selection;
        clear_list();
        delete_tree();
        
        
    
        var tree_arr_cat = eval(selection + "_trees");
        for(var index = 0; index < tree_arr_cat.length; index++){
            var new_option = document.createElement("option");
            var new_op_text = tree_arr_cat[index];

            while( new_op_text.indexOf("_") != -1){
                new_op_text = new_op_text.replace("_", " ");
            }

            var new_op_val = selection + "_" + tree_arr_cat[index];

            new_option.innerHTML = new_op_text;
            new_option.value = new_op_val;

            document.getElementById("tree_selection").add(new_option);
        }
        
    }
    update_header(selection);
    
    
}

function select_armor(selection){
    var gear_selection = "";
    switch(selection){
        case "lrb":
            gear_selection = "Low Rank Blademaster Armor";
            break;
            
        case "lrg":
            gear_selection = "Low Rank Gunner Armor";
            break;
            
        case "hrb":
            gear_selection = "High Rank Blademaster Armor";
            break;
            
        case "hrg":
            gear_selection = "High Rank Gunner Armor";
            break;
            
        case "grb":
            gear_selection = "G Rank Blademaster Armor";
            break;
            
        case "grg":
            gear_selection = "G Rank Gunner Armor";
            break;
            
        case "rlc":
            gear_selection = "Relic Armor";
            break;
    }
    
    var body_message = "Your selection of " + gear_selection + " is currently unavailable" + "<br>" + "Please select a different option."
    
    pop_up("NOTICE", body_message);
}

function pop_up(header_message, body_message){
    document.getElementById("message_box").style.display = "block";
    document.getElementById("pop_header").innerHTML = header_message;
    document.getElementById("pop_header").style.textAlign = "center";
    document.getElementById("message_bod").innerHTML = body_message;
    document.getElementById("message_bod").style.textAlign = "center";
   
}

function close_message(){
    document.getElementById("message_box").style.display = "none";
}

function display_tree_header(){
    document.getElementById("tree_header").style.opacity = "1";
    document.getElementById("tree_header").style.visibility = "visible";
}

function hide_header(){
    document.getElementById("tree_header").style.opacity = "0";
    document.getElementById("tree_header").style.visibility = "hidden";
}

function update_header(selection){
    var wpn_class = document.getElementById(selection).innerHTML;
    var display_string = wpn_class + " Tree";
    document.getElementById("tree_header_top").innerHTML = display_string;
    display_tree_header();
}

function update_header_body(path){
    var stripped_str = path.slice(path.indexOf('_') + 1);
    while(stripped_str.indexOf('_') != -1){
        stripped_str = stripped_str.replace('_', ' ');
    }
    
    document.getElementById("tree_header_bot").innerHTML = stripped_str;
}

function calculate_cost(selected_node){
    var curr_node = Object.assign({}, selected_node);
    var shop_cost = selected_node.shop;
    var craft_cost = selected_node.craft;
    var upgrade_cost = [];
    if(selected_node.upgrade.length > 0){
        
        var raw_info = upgrade_options(curr_node);
        
        upgrade_cost = raw_info.slice(1, raw_info.length);
    }
    var acquisition_options = [shop_cost, craft_cost, upgrade_cost];
    return acquisition_options;
}

function add_dictionary(dict1, dict2){
    var base = Object.assign({}, dict1);
    var op = Object.assign({}, dict2);
    
    var base_key = Object.keys(base);
    
    var op_key = Object.keys(op);
    
    var result_dict = {};
    
    var interim_value = 0;
    
    for(var i = 0; i < op_key.length; i++){
        
        if(base_key.indexOf(op_key[i]) != -1){
            interim_value = base[op_key[i]] + op[op_key[i]];
            
            base[op_key[i]] = interim_value;
        }
        else{
            base[op_key[i]] = op[op_key[i]];
        }
    }
    result_dict = Object.assign({}, base);
    return result_dict;
}

function upgrade_options(curr_node){
    //keep using arrays instead
    var work_node = Object.assign({}, curr_node);
    var result_arr = [];
    var current_total = {};
    var alt_total = {};
    var next_parent = work_node.parent;
    
    curr_node = Object.assign({}, get_keyVal_pair(work_node.upgrade));
    result_arr.push(curr_node);
    
    while(next_parent.length > 0){
        work_node = Object.assign({}, curr_selected_tree[next_parent[2]][next_parent[1]]);
        
        
        if(work_node.craft.length > 0){
            alt_total = add_dictionary(result_arr[0], get_keyVal_pair(work_node.craft));
            alt_total["Base"] = work_node.name;
            alt_total["Method"] = "Craft";
            result_arr.push(alt_total);
        }
        
        if(work_node.shop != "N/A"){
            alt_total = Object.assign({}, result_arr[0]);
            alt_total["Cost"] = alt_total["Cost"] + parseInt(work_node.shop);
            alt_total["Base"] = work_node.name;
            alt_total["Method"] = "Buy";
            result_arr.push(alt_total);
        }
        
        if(work_node.upgrade.length > 0){
            current_total = add_dictionary(result_arr[0], get_keyVal_pair(work_node.upgrade));
            result_arr[0] = Object.assign({}, current_total);
        }
     
        next_parent = work_node.parent;
    }
    return result_arr;
}

function get_keyVal_pair(base_arr){
    var result_dict = {};
    result_dict["Cost"] = parseInt(base_arr[0]);
    for(var i = 1; i < base_arr.length; i+=2){
        result_dict[base_arr[i]] = parseInt(base_arr[i+1]);
    }
    return result_dict;
}

function dragPanel(panel){
    var pos1 = 0;
    var pos2 = 0;
    var pos3 = 0;
    var pos4 = 0;
    
    
    document.getElementById("cost_panel_header").onmousedown = mouseDrag;
    
    function mouseDrag(e){
        e = e || window.event;
        
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = stopMouseDrag;
        document.onmousemove = panelDrag;
    }
    
    function panelDrag(e){
        e = e|| window.event;
        panel.style.transition = '0s';
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        
        panel.style.top = (panel.offsetTop - pos2) + 'px';
        panel.style.left = (panel.offsetLeft - pos1) + 'px';
        
        
    }
    
    function stopMouseDrag(){
        panel.style.transition = "300ms";
        document.onmouseup = null;
        document.onmousemove = null;
    }
}

function append_craft_options (cost_arr){
    var work_arr = cost_arr.slice();
    if(document.getElementById("options_cont").innerHTML != ""){
        return;
    }
    if(cost_arr[0] != "N/A"){
        document.getElementById("shop_cost_line").innerHTML = "Buy for " + cost_arr[0];
    }
    
    var num_options = 0;
    if(cost_arr[1].length > 0){
        
        num_options = 1;
    }
    num_options += cost_arr[2].length;
    var container_height = (num_options  * 20) + 50;
    var panel_height = container_height + 40;
    
    document.getElementById("main_cost_panel").style.height = panel_height + "px";
    document.getElementById("options_cont").style.height = container_height + "px";
    
    if(cost_arr[1].length > 0 || work_arr[2].length > 0){
        var op_nDiv = document.createElement('div');
        var op_mBr_nDiv = document.createElement('div');
    
        op_nDiv.className = "details_cont";
        op_mBr_nDiv.className = "min_bar";
    
        op_nDiv.id = "details_container";
        op_mBr_nDiv.id = "details_min_bar";
    
        op_nDiv.appendChild(op_mBr_nDiv);
        document.getElementById("options_cont").appendChild(op_nDiv);
    }
    
    if(cost_arr[1].length > 0){
        var cr_nDiv = document.createElement('div');
        cr_nDiv.id = "cr_mat_0";
        cr_nDiv.className = "cost_panel_line";
        var craft_cost_obj = Object.assign({}, get_keyVal_pair(work_arr[1]));
        cr_nDiv.onclick = function(){
            expand_option(craft_cost_obj);
        }
        cr_nDiv.innerHTML = "Craft Directly";
        document.getElementById("options_cont").appendChild(cr_nDiv);
    }
    
    if(work_arr[2].length > 0){
        
        
        for(var index = 0; index < work_arr[2].length; index++){
            create_option(work_arr[2][index], index);
        }
    }
    
}

function create_option(mat_obj, index){
    var curr_obj = Object.assign(mat_obj);
    
    var entry = curr_obj.Method;
    var base = curr_obj.Base;
    var option_str = "";
    var nDiv = document.createElement('div');
    nDiv.id = "up_craft_" + index;
    nDiv.className = "cost_panel_line";
    option_str = entry.slice(0,1) + ": " + base;
    nDiv.innerHTML = option_str;
    nDiv.onclick = function(){
        expand_option(curr_obj);
    }
    document.getElementById("options_cont").appendChild(nDiv);
}

function expand_option(mat_obj){
    var working_arr = Object.assign({}, mat_obj);
    var key_list = Object.keys(working_arr);
    
    key_list.splice(key_list.indexOf("Base"), 1);
    key_list.splice(key_list.indexOf("Method"), 1);
    
    var window_height = ((key_list.length + 1) * 21) + 10;
    
    document.getElementById("details_container").innerHTML = "";
    document.getElementById("details_container").style.height = window_height + 'px';
    document.getElementById("details_container").style.left = "-204px";
    
    
}

function clear_cost_panel(){
    document.getElementById("options_cont").innerHTML = "";
}

document.getElementById('gen_button').addEventListener("click", function(){
    var selected_tree = document.getElementById("tree_selection").value;
    if (selected_tree != "Empty"){
        disp_Tree(eval(selected_tree));
        display_tree_header();
        update_header_body(selected_tree);
        curr_selected_tree = eval(selected_tree);
    }
    
});

document.getElementById('del_button').addEventListener("click", function(){
    
    delete_tree();
});

document.getElementById("toggle_img").addEventListener("click", function(){
    document.getElementById("options").style.visibility = 'hidden';
    document.getElementById("options").style.opacity = '0';
    
    document.getElementById("toggle_button").style.visibility = 'visible';
    document.getElementById("toggle_button").style.opacity = '1';

});

document.getElementById("toggle_button").addEventListener("click", function(){
    document.getElementById("toggle_button").style.visibility = 'hidden';
    document.getElementById("toggle_button").style.opacity = '0';
    
    document.getElementById("options").style.visibility = 'visible';
    document.getElementById("options").style.opacity = '1';

});

document.getElementById("op_weap").addEventListener("click", function(){
    var element1 = document.getElementById("options_middle");
    var style1 = window.getComputedStyle(element1);
    var att_value1 = parseInt(style1.getPropertyValue('top'));
    
    var element2 = document.getElementById("options_bottom");
    var style2 = window.getComputedStyle(element2);
    var att_value2 = parseInt(style1.getPropertyValue('top'));
    
    var new_val1;
    var new_val2;
    
    if(weap_toggle == 0){
        element1.style.top = 280 + 'px';
        
        weap_toggle = 1;
        
        if(arm_toggle == 1){
            element2.style.top = 420 + 'px';
        }
        else{
            element2.style.top = 280 + 'px';
        }
        
    }
    else{
        element1.style.top = 0 + 'px';
        
        if(arm_toggle == 1){
            element2.style.top = 140 + 'px';
        }
        else{
            element2.style.top = 0 + 'px';
        }
        
        weap_toggle = 0;
    }
    

});

document.getElementById("op_armor").addEventListener("click", function(){
    var element1 = document.getElementById("options_bottom");
    var style1 = window.getComputedStyle(element1);
    var att_value1 = parseInt(style1.getPropertyValue('top'));
    
    if(arm_toggle == 0){
        if(weap_toggle == 1){
            element1.style.top = 420 + 'px';
        }
        else{
            element1.style.top = 140+ 'px';
        }
        
        arm_toggle = 1;
    }
    else{
        if(weap_toggle == 1){
            element1.style.top = 280 + 'px';
        }
        else{
            element1.style.top = 0 + 'px';
        }
        
        arm_toggle = 0;
    }

});

document.getElementById("get_cost").addEventListener("click", function(){
    var selected_name = document.getElementById(selected_node+"_title").innerHTML;
    var chosen_node = {};
    
    for(var row = 0; row < curr_selected_tree.length; row++){
        for (var col = 0; col < curr_selected_tree[row].length; col++){
            if(selected_name == curr_selected_tree[row][col].name){
                chosen_node = Object.assign({}, curr_selected_tree[row][col]);
                break;
            }
        }
    }
    var cost_arr = calculate_cost(chosen_node);
    document.getElementById("main_cost_panel").style.left = '-209px';
    document.getElementById("main_cost_panel").style.top = '0px';
    document.getElementById("main_cost_panel").style.visibility = "visible";
    document.getElementById("main_cost_panel").style.opacity = "1";
    document.getElementById("cost_panel_header").innerHTML = chosen_node.name;
    document.getElementById("cost_panel_header").style.color = update_rare_color(chosen_node.rarity);
    //console.log(cost_arr);
        
    append_craft_options(cost_arr);
});

dragPanel(document.getElementById("main_cost_panel"));
